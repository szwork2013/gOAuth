/**
* 初始化入口
**/
function init() {
	// 禁用滚动条
	$(".app").css("overflow", "hidden");
	// 是否弹出重置提示框
	if (sessionStorage.isrecover == "true") {
		delete sessionStorage.isrecover;
		$("body").css("overflow", "hidden");
		$(".app_alert .modal-title").html("恭喜您！");
		$(".app_alert .modal-body").html("密码重置成功，请登录");
		$(".app_alert .confirm").hide();
		$("#btnGb").html("确定");
		$(".app_alert").addClass("success").show();
	}
	// 显示或隐藏密码
	$(".ico_eyes").click(function() {
		// 是否显示密码
		if ($(this).parent().hasClass("app_active")) {
			$(this).parent()
				.removeClass("app_active")
				.find(".txt_password")
				.prop("type", "password");
		} else {
			$(this).parent()
				.addClass("app_active")
				.find(".txt_password")
				.prop("type", "text");
		}
	});
	// 初始化验证
	$validators.init({
		mobile: {
			notEmpty: {
				message: '* 手机号码不能为空'
			},
            regular: {
                reg: /^(0|86|17951)?(13[0-9]|15[012356789]|17[678]|18[0-9]|14[57])[0-9]{8}$/,
                message: '* 手机号码必须合法且为11位数字'
            }
		},
		password: {
			notEmpty: {
				message: '* 登录密码不能为空'
			},
			stringLength: {
				min: 6,
				max: 20,
				message: '* 登录密码长度只允许输入6到20位'
			},
            regular: {
                reg: /^\w{6,20}$/,
                message: '* 登录密码只能包含数字、字母、下划线'
            }
		}
	});
	// 登录系统
	var isbool = true;
	$(".btn_login").click(function() {
		// 验证触发
		if ($validators.start()) {
			// 是否准入
			if (isbool) {
				// 禁止准入
				isbool = false;
				// 调用登录
				$.ajax({
					url: "/api/login",
					type: "post",
					data: {
						mobile: $("input[name='mobile']").val(),
						password: $("input[name='password']").val()
					},
					success: function(data) {
						// 允许准入
						isbool = true;
						// 判断返回
						switch(data.errcode) {
							// 成功
			                case 0:
			                	sessionStorage.bangding = true;
			                	location.href = "/open/home";
			                break;
			                // 该手机号不存在
		                    case 400:
			                    $("body").css("overflow", "hidden");
								$(".app_alert .modal-title").html("对不起！");
								$(".app_alert .modal-body").html("手机号码不存在");
								$(".app_alert .confirm").hide();
								$("#btnGb").html("确定");
								$(".app_alert").addClass("warning").show();
		                    break;
		                    // 该手机号被冻结
		                    case 402:
			                    $("body").css("overflow", "hidden");
								$(".app_alert .modal-title").html("对不起！");
								$(".app_alert .modal-body").html("手机号码被冻结");
								$(".app_alert .confirm").hide();
								$("#btnGb").html("确定");
								$(".app_alert").addClass("warning").show();
		                    break;
		                   	// 手机号或密码错误
		                   	case 401:
		                   		$("body").css("overflow", "hidden");
								$(".app_alert .modal-title").html("对不起！");
								$(".app_alert .modal-body").html("手机号码或登录密码不正确");
								$(".app_alert .confirm").hide();
								$("#btnGb").html("确定");
								$(".app_alert").addClass("warning").show();
		                   	break;
		                   	// 服务器维护中
		                   	case 499:
		                   		$("body").css("overflow", "hidden");
								$(".app_alert .modal-title").html("摊上大事啦！");
								$(".app_alert .modal-body").html("服务器维护中...");
								$(".app_alert .confirm").hide();
								$("#btnGb").html("确定");
								$(".app_alert").addClass("error").show();
		                   	break;
		                   	// 手机号不能为空
		                   	case 403:
		                   		$("body").css("overflow", "hidden");
								$(".app_alert .modal-title").html("对不起！");
								$(".app_alert .modal-body").html("手机号码不能为空");
								$(".app_alert .confirm").hide();
								$("#btnGb").html("确定");
								$(".app_alert").addClass("warning").show();
		                   	break;
		                   	// 密码不能为空
		                   	case 404:
		                   		$("body").css("overflow", "hidden");
								$(".app_alert .modal-title").html("对不起！");
								$(".app_alert .modal-body").html("登录密码不能为空");
								$(".app_alert .confirm").hide();
								$("#btnGb").html("确定");
								$(".app_alert").addClass("warning").show();
		                   	break;
		                }
					}
				});
			}
		}
	});
}