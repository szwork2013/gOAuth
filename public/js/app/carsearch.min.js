function init() {
	// 创建分页搜索对象
	var searchFun = loadingSearch({
		// 列表对象
		body: $(".app_body"),
		// 数据源地址
		urlFun: function (pageindex) {
			return (function () {
				return $("#ishide").val() != "true" ? "/api/carsearch" : "/api/carsearchAll";
			})() + "?choose_year=" + $("input[name='choose_year']").val() + "&choose_city=" + $(".choose_city").val() + "&choose_interval=" + $("input[name='choose_interval']").val() + "&choose_brand=" + $("input[name='choose_brand']").val() + "&choose_series=" + $("input[name='choose_series']").val() + "&pageindex=" + pageindex;
		},
		// 请求类型
		type: "get",
		// 数据源名称
		dataName: "cars",
		// 滚动条对象
		divClass: ".app",
		// 无数据显示图片
		htmlFun: function (msg) {
			return '<img style="position: absolute;top: 130px;" src="/img/app/meiyouche.jpg" />';
		},
		// 结果控制方法
		nullFun: function (msg) {
			// 是否还有车
            $("#isfb").val(!msg.isSs);
            $(".app_img").attr("src", !msg.isSs ? "/img/app/fabu.png" : "/img/app/soushuo.png");
		},
		// 行html生成
		appendFun: function(msg, row, cb) {
			// 加到页面
			cb(
				$("<div></div>").addClass("body_li fadeIn animated").append(
					$("<a></a>").prop(
						"href", (msg.ishide != "true" ? "/open/cardetail" : "/open/cardetailAll") + "?carid=" + row.Innerid + "&isfriend=" + row.isfriend + "&custid=" + row.custid
					).append(
						$("<img width='170' height='140'></img>").addClass("img_li swing animated").attr("src", msg.qnUrl + row.pic_url + "?imageView2/2/w/170/h/140")
					)
				).append(
					$("<div></div>").addClass("content_li").append(
						$("<a></a>").prop(
							"href", (msg.ishide != "true" ? "/open/cardetail" : "/open/cardetailAll") + "?carid=" + row.Innerid + "&isfriend=" + row.isfriend + "&custid=" + row.custid
						).append(
							$("<div></div>").addClass("content_text").append(
								$("<div></div>").addClass("text_title").html(row.model_name)
							).append(
								$("<div></div>").addClass("text_note").html((new Date(row.register_date).format("yyyy年M月")) + "上牌/" + row.mileage + "万公里" )
							).append(
								$("<div></div>").addClass("text_price").append(
									"<span>¥</span>" + row.price + "万"
								)
							)
						)
					).append(
						msg.ishide != 'true' ? $("<div></div>").addClass("content_btn").append(
							row.isfriend != "0" ? (
								row.isfriend != "-1"
								? $("<a></a>").attr("href", "/open/information?innerid=" + row.custid + "&isqc=true").append(
									$("<div></div>").addClass("btnFriend_view pulse animated").html("查看好友")
								) : ""
							) : $("<div></div>").addClass("btnFriend_add pulse animated").attr("onclick", "addRelationsApply('" + row.custid + "')").html("加为好友")
						) : ""
					)
				)
			);
		},
		// 分页触发方法
		scrollFun: function(pageindex) {
			if ($(".app").scrollTop() >= ($(".app_body").height() - 554)) {
            	if ($("#isfb").val() != "true") {
			        searchFun(0);
		        } else {
		        	if (pageindex < 2) {
		        		searchFun(0);
		        	}
		        }
            }
		}
	});

	// 自动选择城市
	var cityid = (function (name) {
		var arr, reg = new RegExp("(^| )" + name + "=([^;]*)(;|$)");
		if(arr = document.cookie.match(reg))
			return unescape(arr[2]);
		else
			return null;
	})("cityid") || "125";
	$(".choose_city").val(cityid);
	sessionStorage.choose_city = cityid;

	// 填充数据准入
	if (sessionStorage.isfill == "true") {
		sessionStorage.isfill == "false";
		// 初始化品牌车系
		var car = (sessionStorage.BrandName_text || "") + (sessionStorage.SeriesName_text ? ("/" + sessionStorage.SeriesName_text || "") : "");
		$(".choose_car span").html(car == "" ? "品牌车系" : car);
		$("input[name='choose_brand']").val(sessionStorage.BrandName_value || "");
		$("input[name='choose_series']").val(sessionStorage.SeriesName_value || "");
	}

	// 控制弹出alert
	if (sessionStorage.isalert == "true" && getQueryString("isalert") == "true") {
		// 禁止滚动
		sessionStorage.isalert = false;
		$("body").css("overflow", "hidden");
		$(".app_alert .modal-title").html("恭喜您！");
		$(".app_alert .modal-body").html("好友添加成功");
		$(".app_alert .confirm").hide();
		$("#btnGb").html("确定");
		$(".app_alert").addClass("success").show();
	} else if (sessionStorage.isalert == "true" && getQueryString("isalert") == "false") {
		// 禁止滚动
		sessionStorage.isalert = false;
		$("body").css("overflow", "hidden");
		$(".app_alert .modal-title").html("对不起！");
		$(".app_alert .modal-body").html("好友添加失败");
		$(".app_alert .confirm").hide();
		$("#btnGb").html("确定");
		$(".app_alert").addClass("warning").show();
	}

	// 选择品牌车系
	$(".choose_car").click(function() {
		location.href = (function () {
			return $("#ishide").val() != "true" ? "/open/carBrand" : "/open/carBrandAll";
		})() + "?isbrand=true&type=2";
	});

	// 下拉选项功能绑定
	createChoose([
		{
			name: "choose_year",
			units: "年",
			placeholder: "使用年限"
		},
		{
			name: "choose_interval",
			units: "万",
			placeholder: "价格区间"
		}
	], function() {
		$(".btnSearch").click();
	});

	// 搜索触发
	$(".btnSearch").click(function() {
		searchFun(1);
	});

	// 返回首页
	$(".btnReturn").click(function() {
		location.href = "/open/home";
	});

	// 切换城市触发
	$(".choose_city").change(function() {
		// 存cokie
		document.cookie = "cityid=" + $(".choose_city").val();
		sessionStorage.choose_city = $(".choose_city").val();
		// 存cokie
		searchFun(1);
	});

	// 是否自动刷新
	if (!getQueryString("choose_city")) {
		$(".btnSearch").click();
	}

	// 缓存链接
	sessionStorage.href = location.href;
}

function addRelationsApply(id) {
	// 添加好友
    $.ajax({
        url: "/api/addRelationsApply",
        type: "post",
        data: {
            innerid: id,
            remark: ""
        },
        success: function(msg) {
        	sessionStorage.isalert = true;
        	window.location.href = msg ? setQueStr(window.location.href, "isalert", "true") : setQueStr(window.location.href, "isalert", "false");
        }
    });
}