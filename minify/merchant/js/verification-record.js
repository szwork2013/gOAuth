$(function(){function t(t){var e="{0} {1}".format(n.CodeName||"",n.timeText||"");(a.StartTime||a.EndTim)&&(e+=" {0}至{1}".format(a.StartTime||"",a.EndTime||"")),sessionStorage.condition=JSON.stringify(a),sessionStorage.conditionText=JSON.stringify(n),e&&" "!=e?$(".current-condition").text(e):$(".current-condition").text("所有核销记录"),$(".totalNumber").text(t.TotalNumber),$(".totalPrice").text((t.TotalPrice||"0")+"元");var o="";if(0==t.aaData.length)return void(i=!0);for(var d=0;d<t.aaData.length;d++)o+='<tr class="tr-record" code="{0}">				<td>{1}</td>				<td>{0}</td>				<td>{2}</td>				<td>{3}</td>			</tr>'.format(t.aaData[d].Code,t.aaData[d].Usedtime.substring(0,10),t.aaData[d].Costprice,t.aaData[d].Title);$("#record-content").append(o)}function e(){$.ajax({url:"/merchant/verificationRecordApi",type:"get",data:a,success:function(e){$("#record-content").html(""),t(e)}})}var a=JSON.parse(sessionStorage.condition||"{}");a.PageIndex=1,$("input[name='code']").val(a.Code||"");var n=JSON.parse(sessionStorage.conditionText||"{}"),i=!1;e(),$("#record-content").delegate(".tr-record","click",function(){var t=$(this).attr("code");location.href="/merchant/verificationRecordDetail?code="+t}),$("input[name='code']").keyup(function(){a.Code=$(this).val(),e()}),$('input[name="search"]').tap(function(){$(".condition-container").show()}),$(".ok").tap(function(){$(".condition-container").hide()}),$(".condition .left div").tap(function(t){var e=$(t.target);e.siblings().removeClass("selected"),e.addClass("selected");var a=e.data("type");$(".condition .right").hide(),$(".condition ."+a).show()}),$(".condition .right > div").click(function(){a.PageIndex=1,i=!1,o=[];var t=$(this);t.siblings().removeClass("selected"),t.addClass("selected"),$(".condition .right > div.selected").each(function(){var t=$(this),i=t.data("time"),o=t.data("value");if(i)if(-1==i)a.StartTime=$(".start-date").val(),a.EndTime=$(".end-date").val(),n.timeText="";else{n.timeText=t.text();var d=(new Date).getMonth(),r=new Date;r.setMonth(d+1),r.setDate(0);var c=new Date;c.setMonth(d-i+1),c.setDate(1),a.StartTime=c.format("yyyy-MM-dd"),a.EndTime=r.format("yyyy-MM-dd")}else n.timeText="",a.StartTime="",a.EndTime="";o&&(n.CodeName=t.text(),a.CardType=o),e()})}),$(".empty").tap(function(){a={},a.PageIndex=1,i=!1,o=[],$(".condition .right > div").removeClass("selected"),$("input[name='code']").val(""),n={},e()}),$(".cancel").tap(function(){a.PageIndex=1,i=!1,o=[],$(".empty").tap(),$(".condition-container").hide()});var o=[];$(window).scroll(function(t){i||o[a.PageIndex]||$(document).scrollTop()+winHeight/scale+50>=winHeight/scale&&(a.PageIndex++,o[a.PageIndex]=!0,e())});var d=(new Date).getFullYear(),r={};r.date={preset:"date"},r["default"]={theme:"android-ics light",display:"modal",mode:"scroller",dateFormat:"yyyy-mm-dd",lang:"zh",startYear:d-10,endYear:d+10,width:190,height:50},$(".start-date, .end-date").mobiscroll($.extend(r.date,r["default"])),$(".start-date, .end-date").change(function(){$(".user-defined").click()}),$(".start-i").click(function(t){$(".start-date").mobiscroll("show")}),$(".end-i").click(function(t){$(".end-date").mobiscroll("show")})});