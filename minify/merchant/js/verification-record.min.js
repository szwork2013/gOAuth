;
//#../../public/merchant/js/verification-record.js
$(function(){function r(r){var i="{0} {1}".format(t.CodeName||"",t.timeText||"");if(e.StartTime||e.EndTim)i+=" {0}至{1}".format(e.StartTime||"",e.EndTime||"");sessionStorage.condition=JSON.stringify(e),sessionStorage.conditionText=JSON.stringify(t),i&&i!=" "?$(".current-condition").text(i):$(".current-condition").text("所有核销记录"),$(".totalNumber").text(r.TotalNumber),$(".totalPrice").text((r.TotalPrice||"0")+"元");var s="";if(r.aaData.length==0){n=!0;return}for(var o=0;o<r.aaData.length;o++)s+='<tr class="tr-record" code="{0}">				<td>{1}</td>				<td>{0}</td>				<td>{2}</td>				<td>{3}</td>			</tr>'.format(r.aaData[o].Code,r.aaData[o].Usedtime.substring(0,10),r.aaData[o].Costprice,r.aaData[o].Title);$("#record-content").append(s)}function i(){$.ajax({url:"/merchant/verificationRecordApi",type:"get",data:e,success:function(e){$("#record-content").html(""),r(e)}})}var e=JSON.parse(sessionStorage.condition||"{}");e.PageIndex=1,$("input[name='code']").val(e.Code||"");var t=JSON.parse(sessionStorage.conditionText||"{}"),n=!1;i(),$("#record-content").delegate(".tr-record","click",function(){var e=$(this).attr("code");location.href="/merchant/verificationRecordDetail?code="+e}),$("input[name='code']").keyup(function(){e.Code=$(this).val(),i()}),$('input[name="search"]').tap(function(){$(".condition-container").show()}),$(".ok").tap(function(){$(".condition-container").hide()}),$(".condition .left div").tap(function(e){var t=$(e.target);t.siblings().removeClass("selected"),t.addClass("selected");var n=t.data("type");$(".condition .right").hide(),$(".condition ."+n).show()}),$(".condition .right > div").click(function(){e.PageIndex=1,n=!1,s=[];var r=$(this);r.siblings().removeClass("selected"),r.addClass("selected"),$(".condition .right > div.selected").each(function(){var n=$(this),r=n.data("time"),s=n.data("value");if(r)if(r==-1)e.StartTime=$(".start-date").val(),e.EndTime=$(".end-date").val(),t.timeText="";else{t.timeText=n.text();var o=(new Date).getMonth(),u=new Date;u.setMonth(o+1),u.setDate(0);var a=new Date;a.setMonth(o-r+1),a.setDate(1),e.StartTime=a.format("yyyy-MM-dd"),e.EndTime=u.format("yyyy-MM-dd")}else t.timeText="",e.StartTime="",e.EndTime="";s&&(t.CodeName=n.text(),e.CardType=s),i()})}),$(".empty").tap(function(){e={},e.PageIndex=1,n=!1,s=[],$(".condition .right > div").removeClass("selected"),$("input[name='code']").val(""),t={},i()}),$(".cancel").tap(function(){e.PageIndex=1,n=!1,s=[],$(".empty").tap(),$(".condition-container").hide()});var s=[];$(window).scroll(function(t){if(n||s[e.PageIndex])return;$(document).scrollTop()+$(window).height()+50>=$(document).height()&&(e.PageIndex++,s[e.PageIndex]=!0,i())});var o=(new Date).getFullYear(),u={};u.date={preset:"date"},u.default={theme:"android-ics light",display:"modal",mode:"scroller",dateFormat:"yyyy-mm-dd",lang:"zh",startYear:o-10,endYear:o+10,width:190,height:50},$(".start-date, .end-date").mobiscroll($.extend(u.date,u["default"])),$(".start-date, .end-date").change(function(){$(".user-defined").click()}),$(".start-i").click(function(e){$(".start-date").mobiscroll("show")}),$(".end-i").click(function(e){$(".end-date").mobiscroll("show")})});
